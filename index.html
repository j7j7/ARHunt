<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>ARHunt (MindAR)</title>
  <link rel="stylesheet" href="./styles.css" />
   <script src="https://aframe.io/releases/1.4.2/aframe.min.js"></script>
   <script src="https://cdn.jsdelivr.net/npm/qrcode/build/qrcode.min.js"></script>

   <!-- MindAR for A-Frame -->
   <script src="https://cdn.jsdelivr.net/npm/mind-ar/dist/mindar-image-aframe.prod.js"></script>
   
   <!-- InstantDB via Skypack -->
   <script type="module">
     try {
       console.log('Loading InstantDB from Skypack...');
       import('https://cdn.skypack.dev/@instantdb/core@0.22.6')
         .then(InstantDB => {
           console.log('InstantDB loaded:', InstantDB);
           window.InstantDB = InstantDB;
           // Dispatch event when InstantDB is ready
           window.dispatchEvent(new CustomEvent('instantdb-ready'));
           console.log('InstantDB ready event dispatched');
         })
         .catch(error => {
           console.error('Failed to load InstantDB:', error);
         });
     } catch (error) {
       console.error('Error in InstantDB loading script:', error);
     }
   </script>
</head>
<body>
   <!-- Start Menu -->
   <div id="menu" class="overlay">
     <div class="panel">
       <h1>ARHunt</h1>
       <p>Find the prepared picture frames in your room. Move your phone to scan!</p>
        <label for="playerName">Enter your name:</label>
        <input type="text" id="playerName" class="input-field" placeholder="Your name" required>
        <button id="startBtn" class="btn primary">Start</button>
        <p class="credits">Created by Jason Severn / Kevin Wong</p>
     </div>
   </div>

  <!-- HUD -->
  <div id="hud" class="overlay hidden">
    <div class="hud-bar">
      <div class="stats">Found <span id="foundCount">0</span>/<span id="totalCount">8</span></div>
      <button id="quitBtn" class="btn ghost">Quit</button>
    </div>
     <div id="foundText" class="found-text"></div>

     <!-- Notifications -->
     <div id="notifications" class="notifications-container"></div>
   </div>

  <!-- Fireworks Effect -->
  <div id="fireworks" class="fireworks-container hidden"></div>

  <!-- Countdown -->
  <div id="countdown" class="overlay hidden">
    <div class="countdown-container">
      <div class="countdown-timer">5</div>
    </div>
  </div>

   <!-- Congratulations -->
   <div id="congrats" class="overlay hidden">
     <div class="panel">
       <h2>Congratulations!</h2>
       <p id="playerNameDisplay"></p>
       <canvas id="qrCodeCanvas"></canvas>
       <p>You found them all! Please take a screenshot of this QR code for your record.</p>
       <button id="restartBtn" class="btn primary">Play Again</button>
     </div>
   </div>

   <!-- AR Scene (MindAR) - Start camera immediately but keep menu overlay -->
   <div id="ar-container">
    <a-scene
      mindar-image="imageTargetSrc: assets/targets/targets.mind; filterMinCF: 0.001; filterBeta: 0.01; maxTrack: 1; uiLoading: false; uiScanning: false; uiError: false;"
      embedded
      loading-screen="enabled: false"
      vr-mode-ui="enabled: false"
      device-orientation-permission-ui="enabled: false">

      <a-camera position="0 0 0" look-ivercontrols="enabled: false"></a-camera>

      <!-- Preload sample overlays -->
      <a-assets>
        <img id="da1" src="assets/overlays/DT1.png" />
        <img id="da2" src="assets/overlays/DT2.jpg" />
        <img id="da3" src="assets/overlays/DT3.png" />
        <img id="da4" src="assets/overlays/DT4.png" />
        <img id="da5" src="assets/overlays/DT5.png" />
        <img id="da6" src="assets/overlays/DT6.png" />
        <img id="da7" src="assets/overlays/DT7.png" />
        <img id="da8" src="assets/overlays/DT8.png" />
      </a-assets>

      <!-- 8 possible targets - simplified to match working MindAR example -->
      <a-entity id="target-0" mindar-image-target="targetIndex: 0">
        <a-plane src="#da1" position="0 0 0" height="1.6" width="1.6" rotation="0 0 0" material="transparent: true;"></a-plane>
      </a-entity>
      <a-entity id="target-1" mindar-image-target="targetIndex: 1">
        <a-plane src="#da2" position="0 0 0" height="1.6" width="1.6" rotation="0 0 0" material="transparent: true;"></a-plane>
      </a-entity>
      <a-entity id="target-2" mindar-image-target="targetIndex: 2">
        <a-plane src="#da3" position="0 0 0" height="1.6" width="1.6" rotation="0 0 0" material="transparent: true;"></a-plane>
      </a-entity>
      <a-entity id="target-3" mindar-image-target="targetIndex: 3">
        <a-plane src="#da4" position="0 0 0" height="1.6" width="1.6" rotation="0 0 0" material="transparent: true;"></a-plane>
      </a-entity>
      <a-entity id="target-4" mindar-image-target="targetIndex: 4">
        <a-plane src="#da5" position="0 0 0" height="1.6" width="1.6" rotation="0 0 0" material="transparent: true;"></a-plane>
      </a-entity>
      <a-entity id="target-5" mindar-image-target="targetIndex: 5">
        <a-plane src="#da6" position="0 0 0" height="1.6" width="1.6" rotation="0 0 0" material="transparent: true;"></a-plane>
      </a-entity>
      <a-entity id="target-6" mindar-image-target="targetIndex: 6">
        <a-plane src="#da7" position="0 0 0" height="1.6" width="1.6" rotation="0 0 0" material="transparent: true;"></a-plane>
      </a-entity>
      <a-entity id="target-7" mindar-image-target="targetIndex: 7">
        <a-plane src="#da8" position="0 0 0" height="1.6" width="1.6" rotation="0 0 0" material="transparent: true;"></a-plane>
      </a-entity>

    </a-scene>
  </div>

   <script type="module" src="./mind-hunt.js"></script>
</body>
</html>